---
import Button from "./Button.astro";
import Text from "./Text.astro";
import Heading from "./Heading.astro";
import Notifybell from "./notifybell.astro";
---

<section
  class="bg-[var(--color-Beige)] py-5 px-4 gap-5 max-w-[400px] md:max-w-[1500px] mx-auto"
>
  <div class="grid grid-cols-3 md:grid-cols-12 gap-2 md:gap-4 items-center">
    <img
      src="/img/baad.webp"
      alt="billede på båd"
      class="w-full h-auto object-cover md:col-span-1"
    />
    <Text stylingclasses="col-span-2 md:col-span-3 mr-24">
      AUSTRALIEN, NEW ZEALAND, VIETNAM, BALI, GILI ISLANDS & LOMBOK
    </Text>
    <Text> 14/12 - 2025 </Text>
    <Text> 3 måneder </Text>
    <Text stylingsclasses="col-span-1 row-start-4"> 77.400 DKK </Text>
    <Text> Få pladser! </Text>
    <Notifybell
      variant="primary"
      size="medium"
      data-modal-target="follow-modal"
      class="flex justify-end items-top col-span-1"
    />

    <Button stylingclasses=" md:col-span-2">Tilmeld dig</Button>
  </div>
</section>

<!-- POPUP -->

<div
  id="follow-modal"
  role="dialog"
  aria-modal="true"
  aria-hidden="true"
  class="fixed inset-0 z-50 hidden"
>
  <div class="absolute inset-0 bg-black/40" data-modal-backdrop></div>

  <div
    class="relative max-w-[680px] mx-auto mt-20 bg-[var(--color-Lightblue)] p-8 drop-shadow-lg"
  >
    <button
      type="button"
      data-modal-close
      aria-label="Luk"
      class="absolute top-3 right-3 text-black text-2xl">×</button
    >
    <Heading
      htmlheading="h1"
      ,
      size="large"
      ,
      font="display"
      ,
      stylingclasses="text-[28px] md:text-[32px] text-[var(--color-Orange)] mb-4"
      >FØLG DENNE REJSE</Heading
    >
    <Text stylingclasses="mb-6"
      >Vi giver besked når der er få ledige pladser tilbage på denne rejse.</Text
    >

    <form
      class="flex flex-col gap-4"
      onsubmit="event.preventDefault(); handleFollowSubmit(event)"
    >
      <input
        type="email"
        name="email"
        placeholder="Email"
        required
        class="px-3 py-2 border-0"
      />
      <Button variant="primary" size="medium">Påmind mig</Button>
    </form>
  </div>
</div>

<script>
  // Enkel modal-åbner/lukker: finder knapper med data-modal-target
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll("[data-modal-target]").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const id = btn.dataset.modalTarget;
        const modal = document.getElementById(id);
        if (!modal) return;
        modal.classList.remove("hidden");
        modal.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      });
    });

    // luk ved klik på close eller backdrop
    document.addEventListener("click", (e) => {
      if (
        e.target.matches("[data-modal-close]") ||
        e.target.matches("[data-modal-backdrop]")
      ) {
        const modal = e.target.closest('[role="dialog"]');
        if (!modal) return;
        modal.classList.add("hidden");
        modal.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
      }
    });

    // luk med Escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        document.querySelectorAll('[role="dialog"]').forEach((m) => {
          if (!m.classList.contains("hidden")) {
            m.classList.add("hidden");
            m.setAttribute("aria-hidden", "true");
            document.body.style.overflow = "";
          }
        });
      }
    });
  });

  // simpel form-submit handler
  function handleFollowSubmit(e) {
    const form = e.target;
    const email = form.querySelector('input[type="email"]').value;
    console.log("Tilmeld (simuleret):", email);
    // luk modal
    const modal = document.getElementById("follow-modal");
    if (modal) {
      modal.classList.add("hidden");
      modal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }
    alert("Tak — du vil modtage en besked når pladserne er ledige.");
  }
</script>
