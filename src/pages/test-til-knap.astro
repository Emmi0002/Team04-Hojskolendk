---
import MainLayout from "../layouts/MainLayout.astro";
import Link from "../components/Link.astro";
import { Image } from "astro:assets";
import thumbsup from "../assets/images/thumbsup.png";
import Heading from "../components/Heading.astro";
import Text from "../components/Text.astro";
import Button from "../components/Button.astro";
import ButtonNotify from "../components/Buttonnotify.astro";
import Footer from "../components/Footer.astro";
import Flipcard from "../components/Flipcard.astro";
---

<MainLayout>
  <Flipcard frontcontent={(<Image src={thumbsup} alt="Tommel op" width={150} height={150} />)} backcontent={(<Text>Dette er bagsiden af flipcardet!</Text>)} stylingclasses="w-40 h-40" />

  <!-- Knappen med tekst -->
  <Button variant="primary" size="medium">Tilmeld dig opholdet</Button>

  <!-- Brug prop name "size" og sæt data-modal-target så knappen åbner modal'en -->
  <ButtonNotify variant="primary" size="medium" data-modal-target="follow-modal">Hold mig opdateret</ButtonNotify>

  <!-- Modal markup (ligger inde på siden) -->
  <div id="follow-modal" role="dialog" aria-modal="true" aria-hidden="true" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/40" data-modal-backdrop></div>

    <div class="relative max-w-[680px] mx-auto mt-20 bg-[var(--color-Lightblue)] p-8 drop-shadow-lg">
      <button type="button" data-modal-close aria-label="Luk" class="absolute top-3 right-3 text-black text-2xl">×</button>
      <Heading htmlheading="h1" , size="large" , font="display" , stylingclasses="text-[28px] md:text-[32px] text-[var(--color-Orange)] mb-4">FØLG DENNE REJSE</Heading>
      <Text stylingclasses="mb-6">Vi giver besked når der er få ledige pladser tilbage på denne rejse.</Text>

      <form class="flex flex-col gap-4" onsubmit="event.preventDefault(); handleFollowSubmit(event)">
        <input type="email" name="email" placeholder="Email" required class="px-3 py-2 border-0" />
        <Button variant="primary" size="medium">Påmind mig</Button>
      </form>
    </div>
  </div>
</MainLayout>

<script>
  // Enkel modal-åbner/lukker: finder knapper med data-modal-target
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll("[data-modal-target]").forEach((btn) => {
      btn.addEventListener("click", (e) => {
        const id = btn.dataset.modalTarget;
        const modal = document.getElementById(id);
        if (!modal) return;
        modal.classList.remove("hidden");
        modal.setAttribute("aria-hidden", "false");
        document.body.style.overflow = "hidden";
      });
    });

    // luk ved klik på close eller backdrop
    document.addEventListener("click", (e) => {
      if (e.target.matches("[data-modal-close]") || e.target.matches("[data-modal-backdrop]")) {
        const modal = e.target.closest('[role="dialog"]');
        if (!modal) return;
        modal.classList.add("hidden");
        modal.setAttribute("aria-hidden", "true");
        document.body.style.overflow = "";
      }
    });

    // luk med Escape
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        document.querySelectorAll('[role="dialog"]').forEach((m) => {
          if (!m.classList.contains("hidden")) {
            m.classList.add("hidden");
            m.setAttribute("aria-hidden", "true");
            document.body.style.overflow = "";
          }
        });
      }
    });
  });

  // simpel form-submit handler
  function handleFollowSubmit(e) {
    const form = e.target;
    const email = form.querySelector('input[type="email"]').value;
    console.log("Tilmeld (simuleret):", email);
    // luk modal
    const modal = document.getElementById("follow-modal");
    if (modal) {
      modal.classList.add("hidden");
      modal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }
    alert("Tak — du vil modtage en besked når pladserne er ledige.");
  }
</script>
